#!/usr/bin/env bash

MAIN_FILESYSTEMS="storage/audiobooks storage/books storage/comics storage/documentaries storage/documents storage/exercise storage/learning storage/movies storage/music storage/photos storage/stand-up storage/television"
RECURISVE_FILESYSTEMS="storage/appdata storage/database"
SYNC_USER=root
SYNC_HOST=backup.netbird.cloud
LOG=/var/log/syncoid.log

{
  for i in $MAIN_FILESYSTEMS; do
    echo "---------------  $(date) - syncing $i -------------"
    /usr/sbin/syncoid \
      --no-sync-snap \
      --recvoptions="o compression=lz4" \
      --create-bookmark \
      --compress none \
      --source-bwlimit 200m \
      storage/"$i" \
      $SYNC_USER@$SYNC_HOST:storage/"$i"
    echo "---------------  $(date) - done $i -------------"
  done
} >> $LOG 2>&1

{
  for i in $RECURISVE_FILESYSTEMS; do
    echo "---------------  $(date) - syncing $i -------------"
    /usr/sbin/syncoid \
      --recursive \
      --no-sync-snap \
      --skip-parent \
      --recvoptions="o compression=lz4" \
      --create-bookmark \
      --compress none \
      --source-bwlimit 200m \
      storage/"$i" \
      $SYNC_USER@$SYNC_HOST:storage/"$i"
    echo "---------------  $(date) - done $i -------------"
  done
} >> $LOG 2>&1
